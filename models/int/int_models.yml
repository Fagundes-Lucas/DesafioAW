version: 2

models:
  - name: int_sales
    description: "Intermediate model for sales data"
    columns:
      - name: pk_order
        tests:
          - unique
          - not_null

      - name: fk_customer
        tests:
          - relationships:
              to: ref('int_customers')
              field: pk_customer

      - name: fk_product
        tests:
          - relationships:
              to: ref('int_products')
              field: pk_product

      - name: fk_creditcard
        tests:
          - relationships:
              to: ref('int_creditcards')
              field: pk_creditcard

      - name: order_total
        tests:
          - check:
              where: "order_total >= 0"

      - name: order_date
        tests:
          - check:
              where: "order_date < ship_date"

  - name: int_customers
    description: "Intermediate model for customer data"
    columns:
      - name: pk_customer
        tests:
          - unique
          - not_null

      - name: fk_store
        tests:
          - relationships:
              to: ref('stg_erp__stores')
              field: pk_store

      - name: fk_person
        tests:
          - relationships:
              to: ref('stg_erp__persons')
              field: pk_person

  - name: int_products
    description: "Intermediate model for product data"
    columns:
      - name: pk_product
        tests:
          - unique
          - not_null

      - name: fk_product_subcategory
        tests:
          - relationships:
              to: ref('stg_erp__productsubcategories')
              field: pk_product_subcategory

      - name: product_price
        tests:
          - check:
              where: "product_price > 0"

  - name: int_creditcards
    description: "Intermediate model for credit card data"
    columns:
      - name: pk_creditcard
        tests:
          - unique
          - not_null

      - name: creditcard_type
        tests:
          - accepted_values:
              values: ['Visa', 'MasterCard', 'Amex', 'Discover']

  - name: int_locations
    description: "Intermediate model for locations data"
    columns:
      - name: pk_stateprovince
        tests:
          - unique
          - not_null

      - name: fk_country
        tests:
          - relationships:
              to: ref('stg_erp__countryregion')
              field: pk_country
